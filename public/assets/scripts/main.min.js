$(document).ready(function(){function t(t,e){if(0===t.length)return-1;for(var s=0;s<t.length;s++)if(t[s]===e)return s;return-1}function e(){x=[],$(".rc").each(function(t,e){x.push($(e).text())})}function s(t){var e,s="";for(var l in C[t].routes)s+='<li class="route">\n	<span class="route-title">'+l+'</span>\n<div class="detail"><a href="#" class="detail-txt">Подробнее</a></div>\n</li>';e='<div class="route-section">\r\n					<h2 class="district-title">'+t+':</h2>\r\n						<ul class="route-list">\n'+s+"</ul></div>",$(g).append(e),$(".route-title").on("click",o)}function l(){$("#list .item").on("click",function(){var l=$(this).text();-1===t(x,l)&&(x.push(l),$(v).before("<span class='rc'>"+l+"<i class='cross'></i></span>"),s(l)),$("#main-input span:nth-last-child(2) > .cross").on("click",function(){var t=$(this).parent("span").text();$(this).parent("span").remove(),$(".district-title:contains("+t+":)").closest(".route-section").remove(),e()})})}function i(t){return function(e){for(var s=0;s<e.length;s++)$(list).append(n(e[s],t));l()}}function a(t,e){t=t.toLowerCase();var s=[];for(var l in C)s.push(l);for(var i=[],l=0;l<s.length;l++)~s[l].toLowerCase().indexOf(t)&&i.push(s[l]);e(i),p=i.length>0?!1:!0}function n(t,e){e=e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var s=new RegExp("("+e.split(" ").join("|")+")","gi");return'<li class="item" data-val="'+t+'">'+t.replace(s,"<b>$1</b>")+"</li>"}function o(){var t=$(this).closest(".route"),e=$(".detail-txt",t),s=t.closest(".route-section").children(".district-title").text();s=s.substring(0,s.length-1);var l=C[s].routes[$(this).text()];console.log(l),$(e).one("click",function(e){e.preventDefault(),$(t).toggleClass("detailed"),c?c.get(0)===t.get(0)?(console.log("2"),t.hasClass("detailed")?(c=t,$(".context").remove(),r(l,t)):(c=null,$(".context").remove(),console.log("bug"))):(console.log("3"),c.removeClass("detailed"),c=t,$(".context").remove(),r(l,t)):(console.log("1"),c=t,r(l,t)),$("#routes .vars").mCustomScrollbar({theme:"minimal-dark",autoHideScrollbar:!0})}),t.toggleClass("active"),t.hasClass("detailed")&&(t.toggleClass("detailed active"),$(".context").remove())}function r(t,e){if(!("object"==typeof t&&t instanceof Array))return"";for(var s="",l="",i=0;i<t.length;i++)s+='<li class="item">'+t[i]+"</li> \n";l='<div class="context"><div class="context-head"><div class="end">'+t[0]+" - "+t[t.length-1]+'</div><div class="arrow arrow-bottom"></div></div><ul id="stop-list" class="vars">'+s+"</ul></div>";var a=$(e).closest(".route-list"),n=$(a).children(".route").length,o=$(e).closest(".route-list").children(".route").index($(e))+1,r=4*Math.ceil(o/4);r===4*Math.ceil(n/4)?$(a).append(l):$(a).children(".route").eq(r-1).after(l)}var c,d=document.getElementById("toggle-panel"),u=document.getElementById("panel"),h=document.getElementById("main-input"),v=(document.getElementById("list"),document.getElementById("txt")),g=$("#routes"),m=$(".input-menu .arrow"),p=!1,f={"Автово":{routes:{"К 145":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 146":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 14":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 148":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 135":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],145:["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"]}},"Адмиралтейская":{routes:{"К 65":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 46":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 4":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 48":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 35":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],45:["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"]}}},C=JSON.parse(JSON.stringify(f)),x=[];$(d).on("click",function(){$(this).toggleClass("active"),$(this).hasClass("active")?$(this).removeClass("arrow-right").addClass("arrow-left"):$(this).removeClass("arrow-left").addClass("arrow-right"),$(u).toggleClass("hidden")}),$(m).on("click",function(){$("#list").toggleClass("show"),$(this).hasClass("active")?$(this).removeClass("arrow-top").addClass("arrow-bottom"):$(this).removeClass("arrow-bottom").addClass("arrow-top"),$(this).toggleClass("active")}),$(u).on("click",function(t){!$(t.target).is(".input-menu *")&&$(m).hasClass("active")&&$(m).click()}),$(".input-menu").on("click",function(){x.length>0?$(v).hasClass("ph-hidden")||$(v).addClass("ph-hidden"):$(v).hasClass("ph-hidden")&&$(v).removeClass("ph-hidden")}),$(h).click(function(){$(v).focus()}),$("#txt").on("input propertychange",function(){var t=$(this).val();$(list).children().remove(),t.length>=1?(a(t,i(t)),$(m).hasClass("active")||$(m).click()):$(m).hasClass("active")&&$(m).click()}),$(".panel-wrap").mCustomScrollbar({theme:"minimal-dark",autoHideScrollbar:!0})});