$(document).ready(function(){ymaps.ready(function(){function t(t,e){if(0===t.length)return-1;for(var s=0;s<t.length;s++)if(t[s]===e)return s;return-1}function e(){M=[],$(".rc").each(function(t,e){M.push($(e).text())})}function s(){$(this).toggleClass("active"),$(this).hasClass("active")?$(this).removeClass("arrow-right").addClass("arrow-left"):$(this).removeClass("arrow-left").addClass("arrow-right"),$(f).toggleClass("hidden")}function a(){$(k).val(""),$(".rc").remove(),e(),$(".route-section").remove()}function o(t){var e,s="";for(var a in E[t].routes)s+='<li class="route">\n	<span class="route-title">'+a+'</span>\n<div class="detail"><a href="#" class="detail-txt">Подробнее</a></div>\n</li>';e='<div class="route-section"><h2 class="district-title">'+t+':</h2><ul class="route-list">\n'+s+"</ul></div>",$(y).append(e),$(".route-title").one("click",m)}function i(){$("#list .item").on("click",function(){var s=$(this).text();-1===t(M,s)&&(M.push(s),$(k).before("<span class='rc'>"+s+"<i class='cross'></i></span>"),$(k).val(""),o(s)),$("#main-input span:nth-last-child(2) > .cross").on("click",function(){var t=$(this).parent("span").text();$(this).parent("span").remove(),$(".district-title:contains("+t+":)").closest(".route-section").remove(),e()})})}function l(t){t.stopImmediatePropagation();var e,s,a=t.keyCode||t.which,o=$("#list"),i=$(".item",o);0!==i.size()&&(38===a||40===a?i.hasClass("selected")?(s=o.find(".selected"),e=38===a?0===s.index()?s:s.prev():s.index()===i.length-1?s:s.next(),s.removeClass("selected"),e.addClass("selected")):(e=i.first(),e.addClass("selected")):13===a?o.hasClass("show")&&o.find(".selected").trigger("click"):27===a&&o.hasClass("show")&&$(b).trigger("click"))}function n(t){return function(e){for(var s=0;s<e.length;s++)$(list).append(c(e[s],t));i()}}function r(t,e){t=t.toLowerCase();var s=[];for(var a in E)s.push(a);for(var o=[],i=0;i<s.length;i++)~s[i].toLowerCase().indexOf(t)&&o.push(s[i]);e(o),$(list).mCustomScrollbar({theme:"minimal-dark",autoHideScrollbar:!0}),I=o.length>0?!1:!0}function c(t,e){e=e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var s=new RegExp("("+e.split(" ").join("|")+")","gi");return'<li class="item" data-val="'+t+'">'+t.replace(s,"<b>$1</b>")+"</li>"}function d(t,e){if(!("object"==typeof t&&t instanceof Array))return"";for(var s="",a="",o=0;o<t.length;o++)s+='<li class="item">'+t[o]+"</li> \n";a='<div class="context"><div class="context-head"><div class="end">'+t[0]+" - "+t[t.length-1]+'</div><div class="arrow arrow-bottom"></div></div><ul id="stop-list" class="vars">'+s+"</ul></div>";var i=$(e).closest(".route-list"),l=$(i).children(".route").length,n=$(e).closest(".route-list").children(".route").index($(e))+1,r=4*Math.ceil(n/4);r===4*Math.ceil(l/4)?$(i).append(a):$(i).children(".route").eq(r-1).after(a),$(".context .arrow").one("click",h)}function h(){$(".context .vars").toggleClass("show"),$(this).hasClass("active")?$(this).removeClass("arrow-top").addClass("arrow-bottom"):$(this).removeClass("arrow-bottom").addClass("arrow-top"),$(this).toggleClass("active"),$(this).one("click",h)}function u(t){t.preventDefault(),$(".type").not($(this)).removeClass("active"),$(this).toggleClass("active"),$(C).removeClass("show"),a(),$(this).hasClass("active")&&($(C).addClass("show"),$(k).attr("placeholder",$(this).data("hint")))}function m(t){t.stopImmediatePropagation();var e=$(this).closest(".route"),s=$(".detail-txt",e),a=e.closest(".route-section").children(".district-title").text();a=a.substring(0,a.length-1);var o=E[a].routes[$(this).text()];console.log(o),$(s).one("click",function(t){t.preventDefault(),t.stopImmediatePropagation(),$(e).toggleClass("detailed"),g?g.get(0)===e.get(0)?(console.log("2"),e.hasClass("detailed")?(g=e,$(".context").remove(),d(o,e)):(g=null,$(".context").remove(),console.log("bug"))):(console.log("3"),g.removeClass("detailed"),g=e,$(".context").remove(),d(o,e)):(console.log("1"),g=e,d(o,e)),$("#routes .vars").mCustomScrollbar({theme:"minimal-dark",autoHideScrollbar:!0})}),v(),e.toggleClass("active"),e.hasClass("detailed")&&(e.toggleClass("detailed active"),$(".context").remove()),$(this).one("click",m)}function v(){ymaps.route(["Питер Метро Московская","Питер Метро Международная"]).then(function(t){B&&myMap.geoObjects.remove(B),B=t,myMap.geoObjects.add(t)},function(t){console.log("Возникла ошибка: "+t.message)})}var g,p=document.getElementById("toggle-panel"),f=document.getElementById("panel"),C=$(".input-menu"),w=document.getElementById("main-input"),k=(document.getElementById("list"),document.getElementById("txt")),x=$(".type"),y=$("#routes"),b=$(".input-menu .arrow"),I=!1,S={"Автово":{routes:{"К 145":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 146":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 14":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 148":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 135":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],145:["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"]}},"Адмиралтейская":{routes:{"К 65":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 46":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 4":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 48":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 35":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],45:["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"]}},"Привокзальная":{routes:{"К 65":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 46":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 4":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 48":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 35":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],45:["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"]}},"Волково":{routes:{"К 65":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 46":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 4":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 48":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 35":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],45:["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"]}}},E=JSON.parse(JSON.stringify(S)),M=[];$(x).on("click",u),$(p).on("click",s),$(b).on("click",function(){$("#list").toggleClass("show"),$(this).hasClass("active")?$(this).removeClass("arrow-top").addClass("arrow-bottom"):$(this).removeClass("arrow-bottom").addClass("arrow-top"),$(this).toggleClass("active")}),$(f).on("click",function(t){!$(t.target).is(".input-menu *")&&$(b).hasClass("active")&&$(b).click()}),$(".input-menu").on("click",function(){M.length>0?$(k).hasClass("ph-hidden")||$(k).addClass("ph-hidden"):$(k).hasClass("ph-hidden")&&$(k).removeClass("ph-hidden")}),$(w).click(function(){$(k).focus()}),$("#txt").on("input propertychange",function(){var t=$(this).val();$(list).children().remove(),$(this).off("keydown"),t.length>=1?(r(t,n(t)),$(b).hasClass("active")||$(b).click()):$(b).hasClass("active")&&$(b).click(),$(this).on("keydown",l)}),$(".panel-wrap").mCustomScrollbar({theme:"minimal-dark",autoHideScrollbar:!0});var B;myMap=new ymaps.Map("map",{center:[59.86411517,30.34650462],zoom:11})})});