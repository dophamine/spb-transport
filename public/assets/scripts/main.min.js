$(document).ready(function(){ymaps.ready(function(){function t(t,e){if(0===t.length)return-1;for(var s=0;s<t.length;s++)if(t[s]===e)return s;return-1}function e(){E=[],$(".rc").each(function(t,e){E.push($(e).text())})}function s(){$(this).toggleClass("active"),$(this).hasClass("active")?$(this).removeClass("arrow-right").addClass("arrow-left"):$(this).removeClass("arrow-left").addClass("arrow-right"),$(p).toggleClass("hidden")}function a(){$(C).val(""),$(".rc").remove(),e(),$(".route-section").remove()}function o(t){var e,s="";for(var a in S[t].routes)s+='<li class="route">\n	<span class="route-title">'+a+'</span>\n<div class="detail"><a href="#" class="detail-txt">Подробнее</a></div>\n</li>';e='<div class="route-section">\r\n					<h2 class="district-title">'+t+':</h2>\r\n						<ul class="route-list">\n'+s+"</ul></div>",$(x).append(e),$(".route-title").one("click",h)}function l(){$("#list .item").on("click",function(){var s=$(this).text();-1===t(E,s)&&(E.push(s),$(C).before("<span class='rc'>"+s+"<i class='cross'></i></span>"),$(C).val(""),o(s)),$("#main-input span:nth-last-child(2) > .cross").on("click",function(){var t=$(this).parent("span").text();$(this).parent("span").remove(),$(".district-title:contains("+t+":)").closest(".route-section").remove(),e()})})}function i(t){return function(e){for(var s=0;s<e.length;s++)$(list).append(r(e[s],t));l()}}function n(t,e){t=t.toLowerCase();var s=[];for(var a in S)s.push(a);for(var o=[],l=0;l<s.length;l++)~s[l].toLowerCase().indexOf(t)&&o.push(s[l]);e(o),$(list).mCustomScrollbar({theme:"minimal-dark",autoHideScrollbar:!0}),b=o.length>0?!1:!0}function r(t,e){e=e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var s=new RegExp("("+e.split(" ").join("|")+")","gi");return'<li class="item" data-val="'+t+'">'+t.replace(s,"<b>$1</b>")+"</li>"}function c(t,e){if(!("object"==typeof t&&t instanceof Array))return"";for(var s="",a="",o=0;o<t.length;o++)s+='<li class="item">'+t[o]+"</li> \n";a='<div class="context"><div class="context-head"><div class="end">'+t[0]+" - "+t[t.length-1]+'</div><div class="arrow arrow-bottom"></div></div><ul id="stop-list" class="vars">'+s+"</ul></div>";var l=$(e).closest(".route-list"),i=$(l).children(".route").length,n=$(e).closest(".route-list").children(".route").index($(e))+1,r=4*Math.ceil(n/4);r===4*Math.ceil(i/4)?$(l).append(a):$(l).children(".route").eq(r-1).after(a),$(".context .arrow").one("click",d)}function d(){$(".context .vars").toggleClass("show"),$(this).hasClass("active")?$(this).removeClass("arrow-top").addClass("arrow-bottom"):$(this).removeClass("arrow-bottom").addClass("arrow-top"),$(this).toggleClass("active"),$(this).one("click",d)}function u(t){t.preventDefault(),$(".type").not($(this)).removeClass("active"),$(this).toggleClass("active"),$(g).removeClass("show"),a(),$(this).hasClass("active")&&($(g).addClass("show"),$(C).attr("placeholder",$(this).data("hint")))}function h(){var t=$(this).closest(".route"),e=$(".detail-txt",t),s=t.closest(".route-section").children(".district-title").text();s=s.substring(0,s.length-1);var a=S[s].routes[$(this).text()];console.log(a),$(e).one("click",function(e){e.preventDefault(),$(t).toggleClass("detailed"),v?v.get(0)===t.get(0)?(console.log("2"),t.hasClass("detailed")?(v=t,$(".context").remove(),c(a,t)):(v=null,$(".context").remove(),console.log("bug"))):(console.log("3"),v.removeClass("detailed"),v=t,$(".context").remove(),c(a,t)):(console.log("1"),v=t,c(a,t)),$("#routes .vars").mCustomScrollbar({theme:"minimal-dark",autoHideScrollbar:!0})}),t.toggleClass("active"),t.hasClass("detailed")&&(t.toggleClass("detailed active"),$(".context").remove()),$(this).one("click",h)}var v,m=document.getElementById("toggle-panel"),p=document.getElementById("panel"),g=$(".input-menu"),f=document.getElementById("main-input"),C=(document.getElementById("list"),document.getElementById("txt")),w=$(".type"),x=$("#routes"),k=$(".input-menu .arrow"),b=!1,y={"Автово":{routes:{"К 145":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 146":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 14":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 148":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 135":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],145:["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"]}},"Адмиралтейская":{routes:{"К 65":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 46":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 4":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 48":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],"К 35":["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"],45:["Славы проспект (ул. Софийская)","Софийская д.40","Софийская д.43","Белы Куна (ул. Софийская)","Белы Куна (ул. Пражская)","Метро Международная"]}}},S=JSON.parse(JSON.stringify(y)),E=[];$(w).on("click",u),$(m).on("click",s),$(k).on("click",function(){$("#list").toggleClass("show"),$(this).hasClass("active")?$(this).removeClass("arrow-top").addClass("arrow-bottom"):$(this).removeClass("arrow-bottom").addClass("arrow-top"),$(this).toggleClass("active")}),$(p).on("click",function(t){!$(t.target).is(".input-menu *")&&$(k).hasClass("active")&&$(k).click()}),$(".input-menu").on("click",function(){E.length>0?$(C).hasClass("ph-hidden")||$(C).addClass("ph-hidden"):$(C).hasClass("ph-hidden")&&$(C).removeClass("ph-hidden")}),$(f).click(function(){$(C).focus()}),$("#txt").on("input propertychange",function(){var t=$(this).val();$(list).children().remove(),t.length>=1?(n(t,i(t)),$(k).hasClass("active")||$(k).click()):$(k).hasClass("active")&&$(k).click()}),$(".panel-wrap").mCustomScrollbar({theme:"minimal-dark",autoHideScrollbar:!0}),myMap=new ymaps.Map("map",{center:[59.93322502,30.38288775],zoom:11})})});